<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Dados do Contrato - Automa√ß√£o de Contratos</title>
    <meta name="description" content="Verifique e edite os dados extra√≠dos do contrato">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <header>
        <div class="container">
            <h1>üìù Verificar e Editar Dados</h1>
            <p>Revise as informa√ß√µes extra√≠das e complete os campos necess√°rios</p>
        </div>
    </header>

    <div class="container">
        <form action="{{ url_for('generate') }}" method="post">
            <input type="hidden" name="contract_id" value="{{ contract_id }}">

            <!-- Loop S√ìCIOS -->
            {% for p in partners %}
            <div class="card">
                <h2>üë§ S√≥cio {{ loop.index }}</h2>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                    <div class="form-group">
                        <label>Nome Completo</label>
                        <input type="text" name="partner_{{ p.id }}_name" value="{{ p.get('name', '') }}"
                            placeholder="Nome completo do s√≥cio">
                    </div>
                    <div class="form-group">
                        <label>Nacionalidade</label>
                        <input type="text" name="partner_{{ p.id }}_nationality" value="{{ p.get('nationality', '') }}"
                            placeholder="Ex: Brasileira">
                    </div>
                    <div class="form-group">
                        <label>Estado Civil</label>
                        <input type="text" name="partner_{{ p.id }}_civil_state" value="{{ p.get('civil_state', '') }}"
                            placeholder="Ex: Solteiro(a), Casado(a)">
                    </div>
                    <div class="form-group">
                        <label>Regime de Bens (se casado)</label>
                        <input type="text" name="partner_{{ p.id }}_regime" value="{{ p.get('regime', '') }}"
                            placeholder="Ex: Comunh√£o parcial">
                    </div>
                    <div class="form-group">
                        <label>Profiss√£o</label>
                        <input type="text" name="partner_{{ p.id }}_profession" value="{{ p.get('profession', '') }}"
                            placeholder="Ex: Empres√°rio(a)">
                    </div>
                    <div class="form-group">
                        <label>Data de Nascimento</label>
                        <input type="text" name="partner_{{ p.id }}_birth_date" value="{{ p.get('birth_date', '') }}"
                            placeholder="DD/MM/AAAA">
                    </div>
                    <div class="form-group">
                        <label>CPF</label>
                        <input type="text" name="partner_{{ p.id }}_cpf" value="{{ p.get('cpf', '') }}"
                            placeholder="000.000.000-00">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Endere√ßo Completo</label>
                        <input type="text" name="partner_{{ p.id }}_address" value="{{ p.get('address', '') }}"
                            placeholder="Rua, n√∫mero, bairro, cidade/UF, CEP">
                    </div>
                </div>

                <h3 style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-color);">üí∞
                    Participa√ß√£o Societ√°ria</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px;">
                    <div class="form-group">
                        <label>Quantidade de Quotas</label>
                        <input type="number" name="partner_{{ p.id }}_quotas" value="{{ p.get('quotas', '') }}"
                            placeholder="Ex: 500">
                    </div>
                    <div class="form-group">
                        <label>Valor em R$</label>
                        <input type="text" name="partner_{{ p.id }}_amount" value="{{ p.get('amount', '') }}"
                            placeholder="Ex: 50.000,00">
                    </div>
                    <div class="form-group">
                        <label>% Participa√ß√£o</label>
                        <input type="text" name="partner_{{ p.id }}_percent" value="{{ p.get('percent', '') }}"
                            placeholder="Ex: 50%">
                    </div>
                </div>
            </div>
            {% endfor %}

            <!-- Dados da Empresa -->
            <div class="card">
                <h2>üè¢ Dados da Empresa</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Raz√£o Social</label>
                        <input type="text" name="company_name" value="{{ company.get('company_name', '') }}"
                            placeholder="Nome completo da empresa">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Endere√ßo da Sede</label>
                        <input type="text" name="company_address" value="{{ company.get('company_address', '') }}"
                            placeholder="Endere√ßo completo da sede">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Objeto Social (Resumo)</label>
                        <textarea name="company_object" rows="3"
                            placeholder="Descri√ß√£o das atividades da empresa">{{ company.get('company_object', '') }}</textarea>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Lista de Atividades (CNAEs)</label>
                        <textarea name="company_cnae_list" rows="4"
                            placeholder="Lista de c√≥digos CNAE e descri√ß√µes">{{ company.get('company_cnae_list', '') }}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Data de In√≠cio</label>
                        <input type="text" name="start_date" value="{{ company.get('start_date', '') }}"
                            placeholder="DD/MM/AAAA">
                    </div>
                </div>
            </div>

            <!-- Capital e Foro -->
            <div class="card">
                <h2>üíº Capital e Foro</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;">
                    <div class="form-group">
                        <label>Capital Social Total (R$)</label>
                        <input type="text" name="capital_currency" value="{{ company.get('capital_currency', '') }}"
                            placeholder="Ex: R$ 100.000,00">
                    </div>
                    <div class="form-group">
                        <label>Capital por Extenso</label>
                        <input type="text" name="capital_amount_text"
                            value="{{ company.get('capital_amount_text', '') }}" placeholder="Ex: Cem mil reais">
                    </div>
                    <div class="form-group">
                        <label>Total de Quotas</label>
                        <input type="text" name="total_quotas" value="{{ company.get('total_quotas', '') }}"
                            placeholder="Ex: 1000">
                    </div>
                    <div class="form-group">
                        <label>Valor Unit√°rio da Quota</label>
                        <input type="text" name="quota_value" value="{{ company.get('quota_value', '') }}"
                            placeholder="Ex: R$ 100,00">
                    </div>
                    <div class="form-group">
                        <label>Cidade do Foro</label>
                        <input type="text" name="forum_city" value="{{ company.get('forum_city', '') }}"
                            placeholder="Ex: S√£o Paulo/SP">
                    </div>
                    <div class="form-group">
                        <label>Data de Assinatura</label>
                        <input type="text" name="signature_date" value="{{ company.get('signature_date', '') }}"
                            placeholder="DD/MM/AAAA">
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin: 48px 0 64px;">
                <button type="submit" class="btn btn-primary btn-lg" id="generateBtn">
                    <span class="btn-text">üìÑ Gerar Contrato DOCX</span>
                </button>
                <div id="progressContainer" class="progress-bar-container"
                    style="display: none; max-width: 300px; margin: 16px auto 0;">
                    <div class="progress-bar progress-bar-indeterminate"></div>
                </div>
                <p id="statusText"
                    style="margin-top: 12px; color: var(--text-secondary); font-size: 0.9rem; display: none;"></p>
            </div>
        </form>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // Toast system
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('removing');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Flash messages
        document.addEventListener('DOMContentLoaded', function () {
            {% with messages = get_flashed_messages(with_categories = true) %}
            {% if messages %}
            {% for category, message in messages %}
            showToast('{{ message }}', '{{ category if category != "message" else "info" }}');
            {% endfor %}
            {% endif %}
            {% endwith %}
        });

        // Form submission
        document.querySelector('form').addEventListener('submit', function (e) {
            const submitBtn = document.getElementById('generateBtn');
            const btnText = submitBtn.querySelector('.btn-text');
            const progressContainer = document.getElementById('progressContainer');
            const statusText = document.getElementById('statusText');

            submitBtn.classList.add('btn-loading');
            btnText.innerHTML = '<span class="loading-spinner"></span>Gerando...';
            progressContainer.style.display = 'block';
            statusText.style.display = 'block';
            statusText.textContent = 'Montando o documento Word...';
            statusText.style.color = 'var(--accent)';

            showToast('Gerando contrato DOCX...', 'info');
        });
    </script>
</body>

</html>