<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Editar Dados do Contrato - Madruga Contabilidade</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <header>
        <div class="container">
            <h1>Verificar e Editar Dados</h1>
        </div>
    </header>

    <div class="container">
        <form action="{{ url_for('generate') }}" method="post">
            <input type="hidden" name="contract_id" value="{{ contract_id }}">

            <!-- Loop S√ìCIOS -->
            {% for p in partners %}
            <div class="card">
                <h2>üë§ S√≥cio {{ loop.index }}</h2>

                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" name="partner_{{ p.id }}_name" value="{{ p.get('name', '') }}">
                </div>
                <div class="form-group">
                    <label>Nacionalidade</label>
                    <input type="text" name="partner_{{ p.id }}_nationality" value="{{ p.get('nationality', '') }}">
                </div>
                <div class="form-group">
                    <label>Estado Civil</label>
                    <input type="text" name="partner_{{ p.id }}_civil_state" value="{{ p.get('civil_state', '') }}">
                </div>
                <!-- Show Regime only if needed, or always show -->
                <div class="form-group">
                    <label>Regime de Bens (se casado)</label>
                    <input type="text" name="partner_{{ p.id }}_regime" value="{{ p.get('regime', '') }}">
                </div>
                <div class="form-group">
                    <label>Profiss√£o</label>
                    <input type="text" name="partner_{{ p.id }}_profession" value="{{ p.get('profession', '') }}">
                </div>
                <div class="form-group">
                    <label>Data de Nascimento</label>
                    <input type="text" name="partner_{{ p.id }}_birth_date" value="{{ p.get('birth_date', '') }}">
                </div>
                <div class="form-group">
                    <label>CPF</label>
                    <input type="text" name="partner_{{ p.id }}_cpf" value="{{ p.get('cpf', '') }}">
                </div>
                <div class="form-group">
                    <label>Endere√ßo Completo</label>
                    <input type="text" name="partner_{{ p.id }}_address" value="{{ p.get('address', '') }}">
                </div>

                <h3>Participa√ß√£o</h3>
                <div class="form-group">
                    <label>Quantidade de Quotas</label>
                    <input type="number" name="partner_{{ p.id }}_quotas" value="{{ p.get('quotas', '') }}">
                </div>
                <div class="form-group">
                    <label>Valor em R$</label>
                    <input type="text" name="partner_{{ p.id }}_amount" value="{{ p.get('amount', '') }}">
                </div>
                <div class="form-group">
                    <label>% Participa√ß√£o</label>
                    <input type="text" name="partner_{{ p.id }}_percent" value="{{ p.get('percent', '') }}">
                </div>
            </div>
            {% endfor %}

            <!-- Dados da Empresa -->
            <div class="card">
                <h2>üè¢ Dados da Empresa</h2>
                <div class="form-group">
                    <label>Raz√£o Social</label>
                    <input type="text" name="company_name" value="{{ company.get('company_name', '') }}">
                </div>
                <div class="form-group">
                    <label>Endere√ßo da Sede</label>
                    <input type="text" name="company_address" value="{{ company.get('company_address', '') }}">
                </div>
                <div class="form-group">
                    <label>Objeto Social (Resumo)</label>
                    <textarea name="company_object" rows="4">{{ company.get('company_object', '') }}</textarea>
                </div>
                <div class="form-group">
                    <label>Lista de Atividades (CNAEs)</label>
                    <textarea name="company_cnae_list" rows="6">{{ company.get('company_cnae_list', '') }}</textarea>
                </div>
                <div class="form-group">
                    <label>Data de In√≠cio</label>
                    <input type="text" name="start_date" value="{{ company.get('start_date', '') }}">
                </div>
            </div>

            <!-- Capital e Foro -->
            <div class="card">
                <h2>üí∞ Capital e Foro</h2>
                <div class="form-group">
                    <label>Capital Social Total (Moeda)</label>
                    <input type="text" name="capital_currency" value="{{ company.get('capital_currency', '') }}">
                </div>
                <div class="form-group">
                    <label>Capital Social Total (Por Extenso)</label>
                    <input type="text" name="capital_amount_text" value="{{ company.get('capital_amount_text', '') }}">
                </div>
                <div class="form-group">
                    <label>Total de Quotas</label>
                    <input type="text" name="total_quotas" value="{{ company.get('total_quotas', '') }}">
                </div>
                <div class="form-group">
                    <label>Valor Unit√°rio da Quota</label>
                    <input type="text" name="quota_value" value="{{ company.get('quota_value', '') }}">
                </div>
                <div class="form-group">
                    <label>Cidade do Foro</label>
                    <input type="text" name="forum_city" value="{{ company.get('forum_city', '') }}">
                </div>
                <div class="form-group">
                    <label>Data de Assinatura</label>
                    <input type="text" name="signature_date" value="{{ company.get('signature_date', '') }}">
                </div>
            </div>

            <div style="text-align: center; margin-bottom: 60px;">
                <button type="submit" class="btn btn-primary" id="generateBtn"
                    style="font-size: 1.2rem; padding: 16px 32px;">
                    <span class="btn-text">Gerar Contrato DOCX</span>
                </button>
                <div id="progressContainer" class="progress-bar-container"
                    style="display: none; max-width: 300px; margin: 15px auto 0;">
                    <div class="progress-bar progress-bar-indeterminate"></div>
                </div>
                <p id="statusText" style="margin-top: 10px; color: var(--text-grey); font-size: 0.9rem; display: none;">
                </p>
            </div>
        </form>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // Toast notification system
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è'
            };

            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('removing');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Show flash messages from backend
        document.addEventListener('DOMContentLoaded', function () {
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        showToast('{{ message }}', '{{ category if category != "message" else "info" }}');
                    {% endfor %}
                {% endif %}
            {% endwith %}
        });

        // Form submission with loading state
        document.querySelector('form').addEventListener('submit', function (e) {
            const submitBtn = document.getElementById('generateBtn');
            const btnText = submitBtn.querySelector('.btn-text');
            const progressContainer = document.getElementById('progressContainer');
            const statusText = document.getElementById('statusText');

            // Activate loading state
            submitBtn.classList.add('btn-loading');
            btnText.innerHTML = '<span class="loading-spinner"></span> Gerando contrato...';
            btnText.style.opacity = '1';
            progressContainer.style.display = 'block';
            statusText.style.display = 'block';
            statusText.textContent = 'Montando o documento Word...';
            statusText.style.color = 'var(--accent-cyan-end)';

            showToast('Gerando contrato DOCX...', 'info');
        });
    </script>
</body>

</html>