<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload de Documentos - Automa√ß√£o de Contratos</title>
    <meta name="description" content="Envie documentos para extra√ß√£o autom√°tica de dados">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <header>
        <div class="container">
            <h1>üì§ Envio de Documentos</h1>
            <p>Envie os documentos para extra√ß√£o autom√°tica ou pule para preencher manualmente</p>
        </div>
    </header>

    <div class="container">
        <form action="/process" method="post" enctype="multipart/form-data" id="multistepForm">
            <input type="hidden" name="partner_count" value="{{ partner_count }}">

            {% for i in range(partner_count) %}
            <div class="partner-section">
                <div class="partner-header">
                    <h2>üë§ S√≥cio {{ i + 1 }}</h2>
                    <span class="file-status" id="status-{{ i }}">Arquivo selecionado ‚úì</span>
                </div>

                <div class="upload-zone" id="dropZone-{{ i }}"
                    onclick="document.getElementById('file-{{ i }}').click()">
                    <p>üìÑ Documento de Identidade</p>
                    <p>(CNH, CIN, RG - Arraste ou clique para enviar)</p>
                    <input type="file" name="files_partner_{{ i }}[]" id="file-{{ i }}" style="display: none;" multiple
                        onchange="updateStatus({{ i }})">
                </div>

                <div class="upload-zone" id="dropZone-addr-{{ i }}"
                    onclick="document.getElementById('file-addr-{{ i }}').click()" style="margin-top: 16px;">
                    <p>üìç Comprovante de Endere√ßo (Opcional)</p>
                    <p>(Conta de luz, √°gua, telefone, banco)</p>
                    <input type="file" name="files_address_{{ i }}[]" id="file-addr-{{ i }}" style="display: none;"
                        onchange="updateStatus('addr-{{ i }}')">
                </div>
                <span class="file-status" id="status-addr-{{ i }}" style="margin-top: 8px;">Comprovante selecionado
                    ‚úì</span>
            </div>
            {% endfor %}

            <!-- Company Docs -->
            <div class="partner-section">
                <div class="partner-header">
                    <h2>üè¢ Documentos da Empresa (Opcional)</h2>
                    <span class="file-status" id="status-company">Arquivo selecionado ‚úì</span>
                </div>
                <div class="upload-zone" id="dropZone-company"
                    onclick="document.getElementById('file-company').click()">
                    <p>Contrato Social anterior, Cart√£o CNPJ, etc.</p>
                    <p>(Arraste ou clique para enviar)</p>
                    <input type="file" name="files_company[]" id="file-company" style="display: none;" multiple
                        onchange="updateStatus('company')">
                </div>
            </div>

            <div style="text-align: center; margin: 48px 0 64px;">
                <!-- Success Banner -->
                <div id="successBanner" class="success-banner"
                    style="display: none; max-width: 500px; margin: 0 auto 24px;">
                    <span class="success-banner-icon">‚úÖ</span>
                    <span class="success-banner-text" id="bannerText">Documentos selecionados com sucesso!</span>
                </div>

                <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                    <span class="btn-text">Processar e Gerar Formul√°rio ‚Üí</span>
                </button>

                <div id="progressContainer" class="progress-bar-container"
                    style="display: none; max-width: 300px; margin: 16px auto 0;">
                    <div class="progress-bar progress-bar-indeterminate"></div>
                </div>

                <p id="statusText" style="margin-top: 12px; color: var(--text-secondary); font-size: 0.9rem;">
                    Se n√£o enviar documentos, o formul√°rio ser√° gerado em branco
                </p>
            </div>
        </form>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // Toast system
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('removing');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        function updateStatus(id) {
            const input = document.getElementById('file-' + id);
            const status = document.getElementById('status-' + id);
            const zone = document.getElementById('dropZone-' + id);

            if (input.files.length > 0) {
                status.style.display = 'block';
                status.textContent = input.files.length + " arquivo(s) selecionado(s) ‚úì";
                zone.classList.add('active');

                const label = id === 'company' ? 'Empresa' : (typeof id === 'number' ? 'S√≥cio ' + (id + 1) : id);
                showToast(`${input.files.length} arquivo(s) adicionado(s)`, 'success');
                updateTotalFiles();
            }
        }

        function updateTotalFiles() {
            const allInputs = document.querySelectorAll('input[type="file"]');
            let total = 0;
            allInputs.forEach(input => total += input.files.length);

            if (total > 0) {
                const banner = document.getElementById('successBanner');
                const bannerText = document.getElementById('bannerText');
                banner.style.display = 'flex';
                bannerText.textContent = `${total} documento(s) pronto(s) para processamento`;
            }
        }

        // Form submission
        document.getElementById('multistepForm').addEventListener('submit', function (e) {
            const submitBtn = document.getElementById('submitBtn');
            const btnText = submitBtn.querySelector('.btn-text');
            const progressContainer = document.getElementById('progressContainer');
            const statusText = document.getElementById('statusText');

            submitBtn.classList.add('btn-loading');
            btnText.innerHTML = '<span class="loading-spinner"></span>Processando...';
            progressContainer.style.display = 'block';
            statusText.textContent = 'Extraindo dados com IA... isso pode levar alguns segundos';
            statusText.style.color = 'var(--accent)';

            showToast('Processando documentos com IA...', 'info');
        });

        // Drag and drop
        const zones = document.querySelectorAll('.upload-zone');
        zones.forEach(zone => {
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.style.borderColor = 'var(--accent)';
                zone.style.background = 'rgba(59, 130, 246, 0.05)';
            });
            zone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                if (!zone.classList.contains('active')) {
                    zone.style.borderColor = 'var(--border-color)';
                    zone.style.background = 'var(--bg-tertiary)';
                }
            });
            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                const inputId = zone.id.replace('dropZone-', 'file-');
                const updateId = inputId.replace('file-', '');
                const input = document.getElementById(inputId);

                if (e.dataTransfer.files.length) {
                    input.files = e.dataTransfer.files;
                    updateStatus(updateId);
                }
            });
        });
    </script>
</body>

</html>